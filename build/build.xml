<?xml version="1.0"?>

<project name="anticontainer" default="xpi">
	
	<target name="clean">
		<delete>
			<fileset dir="." includes="anticontainer.xpi chrome.jar ac.jar chrome.manifest filters.js"/>
		</delete>
		<delete dir="js"/>
	</target>
	
	<target name="genmanifest">
		<copy file="../chrome.manifest" todir="."/>
		<replace file="chrome.manifest">
			<replacetoken>chrome/</replacetoken>
			<replacevalue>jar:chrome/ac.jar!/</replacevalue>
		</replace>
	</target>
	
	
	<target name="genplugins">
		<exec executable="c:/python25/python.exe" dir="." osfamily="windows">
			<arg value="combine.py" />
		</exec>
		<exec executable="python" osfamily="unix" dir=".">
			<arg value="combine.py" />
		</exec>
	</target>
	
	<target name="genfilters">
		<exec executable="c:/python25/python.exe" dir="." osfamily="windows" output="filters.js">
			<arg value="json-to-filters.py" />
		</exec>
		<exec executable="python" osfamily="unix" dir="." output="filters.js">
			<arg value="json-to-filters.py" />
		</exec>
	</target>

	<target name="chromejar" depends="genmanifest">
		<zip destfile="ac.jar" compress="false">
			<zipfileset dir="../chrome" includes="**" />
		</zip>
	</target>
	
	<target name="xpi" depends="clean,chromejar,genmanifest,genplugins,genfilters">
		<zip destfile="anticontainer.xpi" compress="true" level="9" >
			<zipfileset dir="." includes="chrome.manifest" />
			<zipfileset dir="." includes="ac.jar" prefix="chrome"/>
			<zipfileset dir="." includes="filters.js" prefix="defaults/preferences" />
			<zipfileset dir="../defaults/preferences" includes="dtaac.js" prefix="defaults/preferences"/>
			<zipfileset dir="../components" includes="*" prefix="components"/>
			<zipfileset dir="../modules" includes="*.jsm" prefix="modules"/>
			<zipfileset dir=".." includes="install.rdf COPYING SOURCE plugins.json"/>
			<zipfileset dir="../chrome/skin" includes="icon.png" />
		</zip>
	</target>
	
	<target name="genupdaterdf" depends="xpi">
		<exec executable="c:/python25/python.exe" dir="." osfamily="windows">
			<arg value="genhash.py" />
		</exec>
		<exec executable="python" osfamily="unix" dir=".">
			<arg value="genhash.py" />
		</exec>
	</target>

</project>