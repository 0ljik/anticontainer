{
	"type": "sandbox",
	"ns": "downthemall.net",
	"prefix": "VZ Album expander",
	"match": "^http://(www\\.)?(?:studi|mein|schueler)vz\\.net/Photos/Album/[^/]+/[^/]+(/p/\\d+)?$",
	"resolve": "var reImages = /<a[^>]+href=\"(\\/Photos\\/View\\/[^\"]+)\"/img;\nvar rePages = /<a href=\"[^\"]+\\/p\\/(\\d+)\" class=\"pager\" title=\"(\\d+)\"/ig;\n\nvar url = baseURL.match( /((http:\\/\\/(?:www\\.)?(?:studi|mein|schueler)vz\\.net)\\/Photos\\/Album\\/[^\\/]+\\/[^\\/]+)(?:\\/p\\/(\\d+))?/i );\nvar curPage = parseInt(url[3], 10) || 1;\nvar maxPage = curPage;\nvar loaded = 0;\nvar images = [];\n\n// get maximum page\nvar match;\nwhile ((match = rePages.exec(responseText)) != null) {\n\tmaxPage = Math.max(maxPage, match[2]);\n}\n\nfunction parsePage (page) {\n\twith (new Request()) {\n\t\tonload = function() {\n\t\t\tvar m;\n\t\t\twhile ((m = reImages.exec(responseText)) != null) {\n\t\t\t\timages[page-1].push(url[2] + m[1]);\n\t\t\t}\n\t\t\ttryContinue();\n\t\t};\n\t\tonerror = function() {\n\t\t\tmarkGone();\n\t\t\tfinish();\n\t\t};\n\t\topen('GET', url[1] + '/p/' + page);\n\t\tsend();\n\t}\n}\n\nfunction tryContinue () {\n\tif (++loaded < maxPage) {\n\t\treturn;\n\t}\n\tfor (var i = 0; i < maxPage; i++) {\n\t\tfor each (var url in images[i]) {\n\t\t\taddDownload(url);\n\t\t}\n\t}\n\tsetURL(null);\n\tfinish();\n}\n\nfor (var i = 1; i <= maxPage; i++) {\n\timages[i - 1] = [];\n\tif (i != curPage) {\n\t\tparsePage(i);\n\t}\n\telse {\n\t\tvar m;\n\t\twhile ((m = reImages.exec(responseText)) != null) {\n\t\t\timages[i - 1].push(url[2] + m[1]);\n\t\t}\n\t\ttryContinue();\n\t}\n}"
}